Android 分区

之所以是独立分区，是因为各自有对应的功能和用途的考量，可以进行单独读写和格式化。Android 设备包含两类分区：

一类是启动分区，对启动过程至关重要，另一类是用户分区，用于存储与启动无关的信息。

df -h

Filesystem       Size  Used Avail Use% Mounted on
tmpfs            3G  1.0M  3.7G   1% /dev
tmpfs            3G     0  3.7G   0% /mnt
tmpfs            3G     0  3.7G   0% /apex
/dev/block/sda14  11M  112K   11M   1% /metadata
/dev/block/dm-0  2G  2.2G  7.8M 100% /
/dev/block/dm-3  4G  3M  4G   8% /mnt/scratch
overlay          4G  3M  4G   8% /system
overlay          4G  3M  4G   8% /product
overlay          4G  3M  4G   8% /vendor
/dev/block/sde4  18M   3M  18M  18% /vendor/firmware_mnt
/dev/block/sde9   2M   1M   14M  49% /vendor/dsp
/dev/block/sda5   2M  2K   2M   1% /mnt/vendor/persist
/dev/block/sde5   6M  8K   6M   2% /vendor/bt_firmware
/dev/block/sda26  5M   3M   26M  56% /mnt/vendor/vehicledefcfg
/dev/block/sda27  5M   4K   58M   1% /mnt/vendor/vehicleconfig
/dev/block/sda23  1G  6M  4M  58% /mnt/user/iflytek
/dev/block/sda25  1G   8M   2G   1% /mnt/user/navi
/dev/block/sda30  4G  8M  4G   1% /mnt/user/ota
/dev/block/sda20  9M  29M  7M  27% /mnt/user/log
/dev/block/sda31 12M   1M  12M  14% /mnt/user/iflytek4rw
/dev/block/dm-4   1G  1G   1G  10% /data

/boot

这个分区主要包含 android kernel映像 和 ramdisk（一种将一部分RAM模拟为硬盘的技术，用于提高文件访问速度）。

如果此分区被擦除，Android系统将无法启动，除非重建这个分区，或者重新安装包含此分区的ROM。


/system

此分区只读不可写，主要存放Android框架及其相关的配置，包括系统预装app。

擦除这个分区系统仍可启动，可以通过进入recovery模式或者bootloader安装新ROM的形式恢复。

/recovery

从名字也可以看出来，这个分区主要是备份区域，一旦上述分区被损坏，可以通过引导进入此分区机型恢复，通常我们所说的刷机就是在此分区进行。

/data

也叫用户数据区，对开发者来说这也是最重要的分区之一，主要包含用户安装的应用、短信、设置等数据。

如果擦除此区域，相当于重置系统，即恢复出厂默认设置。

/data/app/com.xxxx/ 以包名存放应用安装文件，包括base.apk /lib
/data/data/com.xxxx/ 存放应用数据，包括sp、db等
/data/dalvik-cache 以包名存放优化过的应用dex文件

/cache

Android系统缓存区域，保存系统最常访问的数据和应用程序。擦除后会重新生成，无重大影响。

/sdcard

外置存储分区，主要用于存储一些用户应用数据，比如图片视频等，可安全擦除。

/vendor

厂商定制分区,厂商的某些系统升级可以通过这个分区来实现。

小结：这几大分区，平时开发中我们关注比较多的是/system 和 /data ，尤其用户数据区，用户安装的应用在/data/app/com.xxxx中，

应用的相关数据存储在/data/data/com.xxxx中。还有其他比较重要的/data/dalvik-cache等，感兴趣的可以了解这一分区的详细结构。

## 查看分区大小

cat /proc/partitions

major minor  #blocks  name

179        0  15388672 mmcblk0

179        1      1024 mmcblk0p1

179        2      1024 mmcblk0p2

179        3      10240 mmcblk0p3

179        4      2048 mmcblk0p4

179        5      8192 mmcblk0p5

179        6      8192 mmcblk0p6

179        7      20480 mmcblk0p7

259        0      20480 mmcblk0p8

259        1      40960 mmcblk0p9

259        2      40960 mmcblk0p10

259        3      40960 mmcblk0p11

259        4      20480 mmcblk0p12

259        5      1024 mmcblk0p13

259        6    307200 mmcblk0p14

259        7      40960 mmcblk0p15

259        8    819200 mmcblk0p16

259        9    819200 mmcblk0p17

259      10  13186048 mmcblk0p18

179      16      4096 mmcblk0boot1

179        8      4096 mmcblk0boot0

第一个mmcblk0为emmc的块设备，大小为15388672 KB。



其他的分区我们可以通过命令

ls -l /dev/block/platform/soc/by-name

lrwxrwxrwx root    root              2019-03-13 16:38 baseparam -> /dev/block/mmcblk0p5

lrwxrwxrwx root    root              2019-03-13 16:38 bootargs -> /dev/block/mmcblk0p2

lrwxrwxrwx root    root              2019-03-13 16:38 cache -> /dev/block/mmcblk0p17

lrwxrwxrwx root    root              2019-03-13 16:38 deviceinfo -> /dev/block/mmcblk0p4

lrwxrwxrwx root    root              2019-03-13 16:38 fastboot -> /dev/block/mmcblk0p1

lrwxrwxrwx root    root              2019-03-13 16:38 fastplay -> /dev/block/mmcblk0p9

lrwxrwxrwx root    root              2019-03-13 16:38 fastplaybak -> /dev/block/mmcblk0p10

lrwxrwxrwx root    root              2019-03-13 16:38 kernel -> /dev/block/mmcblk0p11

lrwxrwxrwx root    root              2019-03-13 16:38 logo -> /dev/block/mmcblk0p7

lrwxrwxrwx root    root              2019-03-13 16:38 logobak -> /dev/block/mmcblk0p8

lrwxrwxrwx root    root              2019-03-13 16:38 misc -> /dev/block/mmcblk0p12

lrwxrwxrwx root    root              2019-03-13 16:38 pqparam -> /dev/block/mmcblk0p6

lrwxrwxrwx root    root              2019-03-13 16:38 qbboot -> /dev/block/mmcblk0p13

lrwxrwxrwx root    root              2019-03-13 16:38 qbdata -> /dev/block/mmcblk0p14

lrwxrwxrwx root    root              2019-03-13 16:38 recovery -> /dev/block/mmcblk0p3

lrwxrwxrwx root    root              2019-03-13 16:38 system -> /dev/block/mmcblk0p16

lrwxrwxrwx root    root              2019-03-13 16:38 trustedcore -> /dev/block/mmcblk0p15

lrwxrwxrwx root    root              2019-03-13 16:38 userdata -> /dev/block/mmcblk0p18


可以看到 UserData 对应的分区是 mmcblk0p18  大小为 13186048KB = 12877 M = 12.5 G

在android中，device里面的`BroadConfig.mk`中可以修改userdata的大小，注意这里面的单位为字节

TARGET_USERIMAGES_USE_EXT4 := true

BOARD_SYSTEMIMAGE_PARTITION_SIZE := 838860800

BOARD_USERDATAIMAGE_PARTITION_SIZE := 13502513152

BOARD_CACHEIMAGE_PARTITION_SIZE := 838860800

BOARD_CACHEIMAGE_FILE_SYSTEM_TYPE := ext4

BOARD_FLASH_BLOCK_SIZE := 4096

BOARD_HAVE_BLUETOOTH := true

上述提到的名词： 
emmc ： Embedded Multi Media Card ： 内嵌式存储器标准规格。
是MMC协会订立、主要针对手机或平板电脑等产品的内嵌式存储器标准规格。

NAND Flash+闪存控制芯片+标准接口封装

内置存储器的基础上，又额外加了一个控制芯片，最后再以统一的方式封装，并预留一个标准接口，以便手机客户拿来直接使用。


Android文件系统

文件系统是建立在物理存储上的一套存储和检索系统，所以在同一物理设备的基础上，文件系统的设计好坏也会明显影响整个文件读取和写入的性能表现。

Ext4

Android操作系统依托于Linux，所以主要的文件系统也是从Linux中发展而来，包括exFAT、ext3、ext4等，目前大多数手机仍使用Ext4，

但相对于手机上使用的闪存设备来说，Ext4这一基于Linux的文件系统还有很大的优化空间。

F2FS

F2FS “Flash Friendly File System”，一种专门为闪存而生的文件系统，其优势就是小文件的传输速率更快。

近年来不断的有旗舰机采用这一文件系统，华为、OnePlus、三星等，也使得这一文件系统在高端机上得到普及，促进了它的不断优化和兼容性。

Ext4 vs F2FS

    F2FS 随机读写速度更快

    F2FS减少写的次数，延长固件寿命

    F2FS小文件读写速度更快，降低整理碎片开销

    Ext4 普及率更高，兼容性更好

    Ext 4 大文件读取吊打 F2FS

这里只是介绍，对二者感兴趣的可以参考以下几篇文章：

DIFFERENCE BETWEEN F2FS AND EXT4 FILE SYSTEM

android file system

安卓手机文件系统的二次革命，F2FS后再看EROFS 带你飞！

给你的 Android 手机换个文件系统





